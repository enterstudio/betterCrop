// Generated by CoffeeScript 1.6.1
(function(){var e,t,n,r,i,s,o,u={}.hasOwnProperty;(function(e){var t,n,r,i,s;e.fn.resizable=function(){var e,n;for(n in t){if(!u.call(t,n))continue;e=t[n];s.call(this,n,e)}return this};t={left:{height:0,width:-1,left:-1,top:-0.5},top:{height:-1,width:0,left:-0.5,top:-1},right:{height:0,width:1,left:0,top:-0.5},bottom:{height:1,width:0,left:-0.5,top:0},"top-left":{height:-1,width:-1,left:-1,top:-1},"top-right":{height:-1,width:1,left:0,top:-1},"bottom-left":{height:1,width:-1,left:-1,top:0},"bottom-right":{height:1,width:1,left:0,top:0}};s=function(t,r){var i;i=n.call(this,r);e('<div class="resizable-border resizable-border-'+t+'"></div>').appendTo(this).on("mousedown",i)};n=function(t){var n=this;return function(i){var s,o;i.preventDefault();i.stopPropagation();o={x:i.pageX,y:i.pageY};s=r.call(n,t,o);e(document).on("mousemove",s).one("mouseup",function(t){e(document).off("mousemove",s)});return!1}};r=function(e,t){var n,r=this;n={height:this.height(),width:this.width(),left:this.offset().left,top:this.offset().top};return function(s){var o;o={x:s.pageX-t.x,y:s.pageY-t.y};i.call(r,n,e,o);return!1}};i=function(e,t,n){var r,i;r={height:e.height+n.y*t.height,width:e.width+n.x*t.width};n.y*t.height===0&&(r.height=e.height*r.width/e.width);n.x*t.width===0&&(r.width=e.width*r.height/e.height);e.height/e.width<r.height/r.width?r.height=e.height*r.width/e.width:r.width=e.width*r.height/e.height;i=this.triggerHandler("resize",r);i&&(r=i);r.left=e.left+(r.width-e.width)*t.left;r.top=e.top+(r.height-e.height)*t.top;this.css(r)}})(window.jQuery);(function(e){var t,n;e.fn.draggable=function(){this.on("mousedown",t);return this};t=function(t){var r,i,s;t.preventDefault();t.stopPropagation();i=e(this).offset();s={x:t.pageX-i.left,y:t.pageY-i.top};r=n.apply(e(this),[s]);e(document).on("mousemove",r).one("mouseup",function(t){e(document).off("mousemove",r)});return!1};n=function(e){var t=this;return function(n){var r,i;n.preventDefault();n.stopPropagation();r={left:n.pageX-e.x,top:n.pageY-e.y};i=t.triggerHandler("drag",r);i&&(r=i);t.css(r);return!1}}})(window.jQuery);$(document).ready(function(){window.betterCrop={};betterCrop.$container=$("#img-container");betterCrop.minHeight=betterCrop.$container.height();betterCrop.minWidth=betterCrop.$container.width();betterCrop.maxOffset=betterCrop.$container.offset();return betterCrop.$container.acceptsFileDrops()});(function(e){e.fn.acceptsFileDrops=function(){this.on("dragover dragenter",function(t){t.preventDefault();t.stopPropagation();e(this).addClass("dragover");return!1});this.on("dragleave",function(t){t.preventDefault();t.stopPropagation();e(this).removeClass("dragover");return!1});this.on("drop",function(t){t.preventDefault();t.stopPropagation();e(this).removeClass("dragover");s(t.originalEvent.dataTransfer.files[0]);return!1});this.on("click",function(t){var n=this;t.preventDefault();t.stopPropagation();e('<input type="file">').on("change",function(e){s(e.originalEvent.target.files[0])}).click();return!1});return this}})(window.jQuery);s=function(t){var n;n=new FileReader;n.onload=e;n.readAsDataURL(t)};e=function(e){betterCrop.$container.find("span").text("Loading image...");$("<img>").css({visibility:"hidden"}).attr("src",e.target.result).appendTo(betterCrop.$container).on("load",i)};i=function(e){var t,i,s,u,a,f,l;betterCrop.maxHeight=$(this).height();betterCrop.maxWidth=$(this).width();a=betterCrop.minHeight,f=betterCrop.minWidth,i=betterCrop.maxHeight,u=betterCrop.maxWidth,s=betterCrop.maxOffset;if(u<f||i<a){alert("Image is too small to fit. Try another image.");return}betterCrop.$container.off("dragover dragenter dragleave click").find("ol").remove();if(a/i*u>f){l=a/i*u;t=a}else{t=f/u*i;l=f}$(this).css({visibility:"visible",height:t,width:l,left:(f-l)/2,top:(a-t)/2});betterCrop.$ghost=$('<div class="resizable draggable" id="ghost-img-container"></div>');betterCrop.$ghost.css({height:t,width:l,left:s.left-(l-f)/2,top:s.top-(t-a)/2}).appendTo("body").append($(this).clone()).draggable().on("drag",n).resizable().on("resize",o);$(document).on("keydown",function(e){e.keyCode===13&&r()})};r=function(){var e,t,n,r,i,s,o;e=betterCrop.$ghost,o=betterCrop.minWidth,s=betterCrop.minHeight,i=betterCrop.maxOffset;t=e.height();r=e.width();n=e.offset();if(n.top+t-i.top-s<0||n.left+r-i.left-o<0){alert("Drag the image around to completely fill the box.");return}betterCrop.$ghost.remove();$(document).off("keydown")};n=function(e,n){var r,i,s,o,u,a,f,l;r=betterCrop.$ghost,f=betterCrop.minWidth,a=betterCrop.minHeight,u=betterCrop.maxOffset;s=r.height();o=r.width();i=Math.abs;l=10;i(n.top-u.top)<l&&(n.top=u.top);i(n.top+s-u.top-a)<l&&(n.top=u.top+a-s);i(n.left-u.left)<l&&(n.left=u.left);i(n.left+o-u.left-f)<l&&(n.left=u.left+f-o);setTimeout(t);return n};o=function(e,n){var r,i,s,o;setTimeout(t);o=betterCrop.minWidth,s=betterCrop.minHeight,i=betterCrop.maxWidth,r=betterCrop.maxHeight;if(n.width>i||n.height>r){n.width=i;n.height=r;return n}if(n.width<o){n.width=o;n.height=o/i*r}if(n.height<s){n.height=s;n.width=s/r*i}return n};t=function(e){var t,n,r,i,s,o;n=betterCrop.$ghost,t=betterCrop.$container,o=betterCrop.maxOffset;r=n.height();s=n.width();i=n.offset();t.find("img").css({left:i.left-o.left,top:i.top-o.top,height:r,width:s});n.find("img").css({height:r,width:s})}}).call(this);